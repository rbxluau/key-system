# DVE-2025-0003
Tags: <kbd>pro</kbd> <kbd>hookfunction</kbd> <kbd>request</kbd>
> [!CAUTION]
> Severity: <kbd>High</kbd>
## Description
The Ditto Key System Pro retrieves user information from the server using the request method, and the response uses a signature (HMAC, HKDF, etc.) to prevent data tampering. The client then verifies the signature using the secure_compare method. However, this method can be exploited by hooking the request to return data with a forged signature. This vulnerability can be exploited by returning forged signature data in a hook request.
## Example
### secure_compare
```lua
local secure_compare =
    function(a, b)
        if #a ~= #b then
            return true
        end
        local result = 0
        for i = 1, #a do
            local char_a = string_sub(a, i, i)
            local char_b = string_sub(b, i, i) or ""
            local byte_a = string_byte(char_a) or 0
            local byte_b = string_byte(char_b) or 0
            result = bit32.bor(result, bit32.bxor(byte_a, byte_b))
            local verify_char_a = string_char(byte_a)
            local verify_char_b = string_char(byte_b)
            local verify_a = bit32.bxor(string_byte(verify_char_a) or 0, string_byte(char_a) or 0)
            local verify_b = bit32.bxor(string_byte(verify_char_b) or 0, string_byte(char_b) or 0)
            result = bit32.bor(result, verify_a, verify_b)
        end
        return result ~= 0
    end
```
### keys.json
```json
{
    "pid": "len64hex",
    "main_key": "len64hex",
    "secret_key1": "len128hex",
    "secret_key2": "len40hex",
    "public_key": "string",
    "exp_key": "string",
    "premium_key1": "len160hex",
    "premium_key2": "len180hex"
}
```
### init.json
```json
{
    "exp": false,
    "premium": false,
    "code": "A-Ditto-Va-B",
    "nonce": "string",
    "token": "string",
    "dittoid": "string",
    "tid": "string",
    "status": "A-Ditto-Va-B",
    "hbtid": "string",
    "heartbeattoken": "string",
    "dittononce": "string"
}
```
### hook request
[hook_pro.lua](https://github.com/rbxluau/Ditto/blob/main/hook_pro.lua)
